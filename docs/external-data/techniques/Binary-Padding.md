
# Binary Padding

## Description

### MITRE Description

> Adversaries can use binary padding to add junk data and change the on-disk representation of malware without affecting the functionality or behavior of the binary. This will often increase the size of the binary beyond what some security tools are capable of handling due to file size limitations.

Binary padding effectively changes the checksum of the file and can also be used to avoid hash-based blacklists and static anti-virus signatures.(Citation: ESET OceanLotus) The padding used is commonly generated by a function to create junk data and then appended to the end or applied to sections of malware.(Citation: Securelist Malware Tricks April 2017) Increasing the file size may decrease the effectiveness of certain tools and detection capabilities that are not designed or configured to scan large files. This may also reduce the likelihood of being collected for analysis. Public file scanning services, such as VirusTotal, limits the maximum size of an uploaded file to be analyzed.(Citation: VirusTotal FAQ)


## Aliases

```

```

## Additional Attributes

* Bypass: ['Signature-based detection', 'Anti-virus']
* Effective Permissions: None
* Network: None
* Permissions: None
* Platforms: ['Linux', 'macOS', 'Windows']
* Remote: None
* Type: attack-pattern
* Wiki: https://attack.mitre.org/techniques/T1009

## Potential Commands

```
dd if=/dev/zero bs=1 count=1 >> /tmp/evil-binary

dd if=/dev/zero bs=1 count=1 >> #{file_to_pad}
```
sha1sum welcome.sh >before
dd if=/dev/zero bs=1 count=1 >> welcome.sh
<<
1+0 records in
1+0 records out
1 byte (1 B) copied, 0.000221464 s, 4.5 kB/s
>>
sha1sum welcome.sh >after
cmp before after
<<before after differ: byte 1, line 1>>
```
```

## Commands Dataset

```
[{'command': 'dd if=/dev/zero bs=1 count=1 >> /tmp/evil-binary\n',
  'name': None,
  'source': 'atomics/T1009/T1009.yaml'},
 {'command': 'dd if=/dev/zero bs=1 count=1 >> #{file_to_pad}',
  'name': None,
  'source': 'Kirtar22/Litmus_Test'},
 {'command': '```', 'name': None, 'source': 'Kirtar22/Litmus_Test'},
 {'command': 'sha1sum welcome.sh >before',
  'name': None,
  'source': 'Kirtar22/Litmus_Test'},
 {'command': 'dd if=/dev/zero bs=1 count=1 >> welcome.sh',
  'name': None,
  'source': 'Kirtar22/Litmus_Test'},
 {'command': '<<', 'name': None, 'source': 'Kirtar22/Litmus_Test'},
 {'command': '1+0 records in', 'name': None, 'source': 'Kirtar22/Litmus_Test'},
 {'command': '1+0 records out', 'name': None, 'source': 'Kirtar22/Litmus_Test'},
 {'command': '1 byte (1 B) copied, 0.000221464 s, 4.5 kB/s',
  'name': None,
  'source': 'Kirtar22/Litmus_Test'},
 {'command': '>>', 'name': None, 'source': 'Kirtar22/Litmus_Test'},
 {'command': 'sha1sum welcome.sh >after',
  'name': None,
  'source': 'Kirtar22/Litmus_Test'},
 {'command': 'cmp before after',
  'name': None,
  'source': 'Kirtar22/Litmus_Test'},
 {'command': '<<before after differ: byte 1, line 1>>',
  'name': None,
  'source': 'Kirtar22/Litmus_Test'},
 {'command': '```', 'name': None, 'source': 'Kirtar22/Litmus_Test'}]
```

## Potential Detections

```json
[{'data_source': '```bash_history logs```'},
 {'data_source': {'author': 'Thomas Patzke',
                  'description': 'Code integrity failures may indicate '
                                 'tampered executables.',
                  'detection': {'condition': 'selection',
                                'selection': {'EventID': [5038, 6281]}},
                  'falsepositives': ['Disk device errors'],
                  'id': '470ec5fa-7b4e-4071-b200-4c753100f49b',
                  'level': 'low',
                  'logsource': {'product': 'windows', 'service': 'security'},
                  'status': 'stable',
                  'tags': ['attack.defense_evasion', 'attack.t1009'],
                  'title': 'Failed Code Integrity Checks'}},
 {'data_source': ['4688', 'Process Execution']},
 {'data_source': ['4688 ', 'Process CMD Line']},
 {'data_source': ['4663', 'File monitoring']},
 {'data_source': ['Binary file metadata']},
 {'data_source': ['4688', 'Process Execution']},
 {'data_source': ['4688 ', 'Process CMD Line']},
 {'data_source': ['4663', 'File monitoring']},
 {'data_source': ['Binary file metadata']}]
```

## Potential Queries

```json
[{'name': None,
  'product': 'Splunk',
  'query': '```index=linux sourcetype="bash_history" bash_command="dd *"```'},
 {'name': None, 'product': 'Splunk', 'query': ''}]
```

## Raw Dataset

```json
[{'Atomic Red Team Test - Binary Padding': {'atomic_tests': [{'auto_generated_guid': 'ffe2346c-abd5-4b45-a713-bf5f1ebd573a',
                                                              'dependencies': [{'description': 'The '
                                                                                               'binary '
                                                                                               'must '
                                                                                               'exist '
                                                                                               'on '
                                                                                               'disk '
                                                                                               'at '
                                                                                               'specified '
                                                                                               'location '
                                                                                               '(#{file_to_pad})\n',
                                                                                'get_prereq_command': 'cp '
                                                                                                      '/bin/ls '
                                                                                                      '/tmp/evil-binary\n',
                                                                                'prereq_command': 'if '
                                                                                                  '[ '
                                                                                                  '-f '
                                                                                                  '#{file_to_pad} '
                                                                                                  ']; '
                                                                                                  'then '
                                                                                                  'exit '
                                                                                                  '0; '
                                                                                                  'else '
                                                                                                  'exit '
                                                                                                  '1; '
                                                                                                  'fi;\n'}],
                                                              'dependency_executor_name': 'bash',
                                                              'description': 'Uses '
                                                                             'dd '
                                                                             'to '
                                                                             'add '
                                                                             'a '
                                                                             'zero '
                                                                             'to '
                                                                             'the '
                                                                             'binary '
                                                                             'to '
                                                                             'change '
                                                                             'the '
                                                                             'hash.\n'
                                                                             '\n'
                                                                             'Upon '
                                                                             'successful '
                                                                             'execution, '
                                                                             'dd '
                                                                             'will '
                                                                             'modify '
                                                                             '`/tmp/evil-binary`, '
                                                                             'therefore '
                                                                             'the '
                                                                             'expected '
                                                                             'hash '
                                                                             'will '
                                                                             'change.\n',
                                                              'executor': {'command': 'dd '
                                                                                      'if=/dev/zero '
                                                                                      'bs=1 '
                                                                                      'count=1 '
                                                                                      '>> '
                                                                                      '#{file_to_pad}\n',
                                                                           'elevation_required': False,
                                                                           'name': 'sh'},
                                                              'input_arguments': {'file_to_pad': {'default': '/tmp/evil-binary',
                                                                                                  'description': 'Path '
                                                                                                                 'of '
                                                                                                                 'binary '
                                                                                                                 'to '
                                                                                                                 'be '
                                                                                                                 'padded',
                                                                                                  'type': 'Path'}},
                                                              'name': 'Pad '
                                                                      'Binary '
                                                                      'to '
                                                                      'Change '
                                                                      'Hash - '
                                                                      'Linux/macOS '
                                                                      'dd',
                                                              'supported_platforms': ['macos',
                                                                                      'linux']}],
                                            'attack_technique': 'T1009',
                                            'display_name': 'Binary Padding'}}]
```

# Tactics


* [Defense Evasion](../tactics/Defense-Evasion.md)


# Mitigations

None

# Actors


* [APT32](../actors/APT32.md)

* [Patchwork](../actors/Patchwork.md)
    
* [Moafee](../actors/Moafee.md)
    
* [Leviathan](../actors/Leviathan.md)
    
* [BRONZE BUTLER](../actors/BRONZE-BUTLER.md)
    
